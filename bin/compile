#!/bin/bash
-e
BUILD_DIR=$1

VERSION=unrtf-0.21.9
INSTALL_DIR=$BUILD_DIR/vendor/unrtf/
BIN_DIR=$INSTALL_DIR/bin

# Extract the source
mkdir -p -m 0700 src
cd src
tar xzvf ../${VERSION}.tar.gz
cd ${VERSION}
test $UID = 0 && chown -R root:root .

echo "Files in config folder"
ls config

mkdir -p ${INSTALL_DIR}

# Configure the build
./configure --mandir=/usr/local/man --prefix=${INSTALL_DIR}

# Build it
make

# Install it, stripping the binary
make install-strip

echo "Complete!"
echo "Building runtime environment for unrtf int ${BUILD_DIR}"

mkdir -p $BUILD_DIR/.profile.d

echo "export PATH=\"${BIN_DIR}:\$PATH\"" > $BUILD_DIR/.profile.d/unrtf.sh
